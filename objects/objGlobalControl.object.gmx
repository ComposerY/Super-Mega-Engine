<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-1000</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if global.screen_shader != noone {
    application_surface_draw_enable(false);
}

//Keys
leftKey = vk_left;
rightKey = vk_right;
upKey = vk_up;
downKey = vk_down;
jumpKey = ord('Z');
shootKey = ord('X');
slideKey = ord('C');
pauseKey = vk_space;
weaponSwitchLeftKey = ord('A');
weaponSwitchRightKey = ord('S');
selectKey = vk_shift;

keyboard_set_map(vk_enter, vk_space);
keyboard_set_map(ord('W'), ord('Z'));   //For AZERTY
keyboard_set_map(ord('Q'), ord('S'));   //For AZERTY
keyboard_set_map(ord('Y'), ord('Z'));   //For QWERTZ
keyboard_set_map(ord('R'), ord('S'));   //For COLEMAK
keyboard_set_map(ord('K'), ord('Z'));   //For DVORAK
keyboard_set_map(ord('B'), ord('C'));   //For DVORAK

event_perform(ev_step_begin, 0); //Registers the key inputs


//Variables
global._health = global._maxHealth;
global.weapon = 0;  //Can have values like megabuster, silvertomahawk etc for all weapons in the game, even those that are not on the pause menu
global.currentWeapon = 0;   //Only the weapons used in the level; only those that are on the pause menu

global.font = font_add_sprite(sprFont, ord('!'), true, 0);
global.MM3font = font_add_sprite(sprMM3Font, ord('!'), true, 0);

global.frozen = false;
global.switchingSection = false;
global.currentPickupID = 0; //Each pickup (health, weapon energy, life, tanks) has an ID
                            //This way, we can make it despawn when the room starts if the pickup has already been collected in that level

//Go to the next room if this is the initializing room
//Also, initialize some variables
if room == rmInit {

    global.bgm = -1;
    global.loopStart = -1;
    global.loopEnd = -1;
    
    display_reset(0, true); //Enables V-synch to make everything look nicer (without V-sync, GM Studio games tend to look pretty bad)
    stopAllSFX();
        
    // Max values for several vitals.
    global.maxScrews = 999;
        
    room_goto(initialRoom); //initialRoom is defined in Macros
    global._lives = 2;
    global.screws = 0;
       
    var i;
    for(i = 0; i &lt; 1000; i++) { //If you somehow have over 1000 pickups in one room, increase this number
        global.pickupCollected[i] = false;
    }
    
    global.lastRoom = rmInit;
    global.checkpoint = false;
    global.checkpointX = 0;
    global.checkpointY = 0;
    global.levelStart = false;
    
    global.primaryCol = c_white;
    global.secondaryCol = c_white;
    global.outlineCol = c_black;
    
    for(i = 0; i &lt; global.totalWeapons; i++) {
        global.ammo[i] = global.maxAmmo;
    }
    
    application_surface_draw_enable(true);
}

curr_layer = global.ini_layer;
for (var l = global.ini_layer; l &gt;= global.end_layer; l--) {
    tile_layer_hide(l);
}


//When the level starts, all pickups should spawn
if global.levelStart {
    event_user(0);
    alarm[0] = 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Keys
global.keyLeft = keyboard_check(leftKey) || gamepad_axis_value_any(gp_axislh) &lt; -0.2 || gamepad_button_check_any(gp_padl);
global.keyRight = keyboard_check(rightKey) || gamepad_axis_value_any(gp_axislh) &gt; 0.2 || gamepad_button_check_any(gp_padr);
global.keyUp = keyboard_check(upKey) || gamepad_axis_value_any(gp_axislv) &lt; -0.2 || gamepad_button_check_any(gp_padu);
global.keyDown = keyboard_check(downKey) || gamepad_axis_value_any(gp_axislv) &gt; 0.2 || gamepad_button_check_any(gp_padd);
global.keyJump = keyboard_check(jumpKey) || gamepad_button_check_any(gp_face1) || gamepad_button_check_any(gp_face3);
global.keyShoot = keyboard_check(shootKey) || gamepad_button_check_any(gp_face2) || gamepad_button_check_any(gp_face4);
global.keyPause = keyboard_check(pauseKey) || gamepad_button_check_any(gp_start);
global.keyWeaponSwitchLeft = keyboard_check(weaponSwitchLeftKey) || gamepad_button_check_any(gp_shoulderl) || gamepad_button_check_any(gp_shoulderlb);
global.keyWeaponSwitchRight = keyboard_check(weaponSwitchRightKey) || gamepad_button_check_any(gp_shoulderr) || gamepad_button_check_any(gp_shoulderrb);
global.keySelect = keyboard_check(selectKey) || gamepad_button_check_any(gp_select);

global.keyLeftPressed = keyboard_check_pressed(leftKey) || gamepad_button_check_pressed_any(gp_padl);
global.keyRightPressed = keyboard_check_pressed(rightKey) || gamepad_button_check_pressed_any(gp_padr);
global.keyUpPressed = keyboard_check_pressed(upKey) || gamepad_button_check_pressed_any(gp_padu);
global.keyDownPressed = keyboard_check_pressed(downKey) || gamepad_button_check_pressed_any(gp_padd);
global.keyJumpPressed = keyboard_check_pressed(jumpKey) || gamepad_button_check_pressed_any(gp_face1) || gamepad_button_check_pressed_any(gp_face3);
global.keyShootPressed = keyboard_check_pressed(shootKey) || gamepad_button_check_pressed_any(gp_face2) || gamepad_button_check_pressed_any(gp_face4);
global.keyPausePressed = keyboard_check_pressed(pauseKey) || gamepad_button_check_pressed_any(gp_start);
global.keyWeaponSwitchLeftPressed = keyboard_check_pressed(weaponSwitchLeftKey) || gamepad_button_check_pressed_any(gp_shoulderl) || gamepad_button_check_pressed_any(gp_shoulderlb);
global.keyWeaponSwitchRightPressed = keyboard_check_pressed(weaponSwitchRightKey) || gamepad_button_check_pressed_any(gp_shoulderr) || gamepad_button_check_pressed_any(gp_shoulderrb);
global.keySelectPressed = keyboard_check_pressed(selectKey) || gamepad_button_check_pressed_any(gp_select);

global.keyLeftReleased = keyboard_check_released(leftKey) || gamepad_button_check_released_any(gp_padl);
global.keyRightReleased = keyboard_check_released(rightKey || gamepad_button_check_released_any(gp_padr));
global.keyUpReleased = keyboard_check_released(upKey) || gamepad_button_check_released_any(gp_padu);
global.keyDownReleased = keyboard_check_released(downKey) || gamepad_button_check_released_any(gp_padd);
global.keyJumpReleased = keyboard_check_released(jumpKey) || gamepad_button_check_released_any(gp_face1);
global.keyShootReleased = keyboard_check_released(shootKey) || gamepad_button_check_released_any(gp_face2) || gamepad_button_check_released_any(gp_face3);
global.keyPauseReleased = keyboard_check_released(pauseKey) || gamepad_button_check_released_any(gp_start) || gamepad_button_check_released_any(gp_face4);
global.keyWeaponSwitchLeftReleased = keyboard_check_released(weaponSwitchLeftKey) || gamepad_button_check_released_any(gp_shoulderl) || gamepad_button_check_released_any(gp_shoulderlb);
global.keyWeaponSwitchRightReleased = keyboard_check_released(weaponSwitchRightKey) || gamepad_button_check_released_any(gp_shoulderr) || gamepad_button_check_released_any(gp_shoulderrb);
global.keySelectReleased = keyboard_check_released(selectKey) || gamepad_button_check_released_any(gp_select);

// If the slide key is enabled.
if (global.enableSlideKey) {
    global.keyShoot = keyboard_check(shootKey) || gamepad_button_check_any(gp_face4);
    global.keyShootPressed = keyboard_check_pressed(shootKey) || gamepad_button_check_pressed_any(gp_face4);
    global.keyShootReleased = keyboard_check_released(shootKey) || gamepad_button_check_released_any(gp_face3);
    
    global.keySlide = keyboard_check(slideKey) || gamepad_button_check_any(gp_face2);
    global.keySlidePressed = keyboard_check_pressed(slideKey) || gamepad_button_check_pressed_any(gp_face2);
    global.keySlideReleased = keyboard_check_released(slideKey) || gamepad_button_check_released_any(gp_face2);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if instance_exists(objMegaman) {
    x = objMegaman.x;
    y = objMegaman.y;
}

if global.loopEnd &gt; -1 &amp;&amp; global.loopStart &gt; -1 &amp;&amp; global.bgm &gt; -1 {    //Loop point
    var currPos = audio_sound_get_track_position(global.bgm);
    if currPos &gt;= global.loopEnd - 0.1 {
        var diff = global.loopEnd - global.loopStart;
        var newPos = currPos - diff;
        audio_sound_set_track_position(global.bgm, newPos);
    }
}

tile_layer_show(curr_layer);
curr_layer--;
if curr_layer &lt; global.end_layer {
    curr_layer = global.ini_layer;
    for (var l = global.ini_layer; l &gt;= global.end_layer; l--) {
        tile_layer_hide(l);
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Debug keys
if !cfgEnableDebugKeys {
    exit;
}

if keyboard_check_pressed(vk_f2)
{
    application_surface_draw_enable(true);
    sound_stop_all();
    game_restart();
}

// Suicide.
if keyboard_check_pressed(vk_f3)
{
    global._health = 0;
}
    
if keyboard_check_pressed(vk_f4)
    window_set_fullscreen( !window_get_fullscreen() );
    
if keyboard_check_pressed(vk_escape)
    game_end();
    

if keyboard_check_pressed(vk_f6) debug_password();
if keyboard_check_pressed(vk_f7) saveGame(0);
if keyboard_check_pressed(vk_f8) loadGame(0);
if keyboard_check_pressed(vk_f11) with objMegaman grav *= -1;

if keyboard_check(vk_add) global.screws++;
if keyboard_check(vk_subtract) global.screws--;

if keyboard_check_pressed(vk_f9) {
    global.current_screen_shader++;
    if global.current_screen_shader &gt;= global.num_screen_shaders {
        global.current_screen_shader = 0;
        application_surface_draw_enable(true);
    }
    else {
        application_surface_draw_enable(false);
    }
    global.screen_shader = global.screen_shaders[global.current_screen_shader];
    show_debug_message("Current shader: " +  string(global.current_screen_shader));
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="75">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>print("Event = " + async_load[? "event_type"]);        // Debug cocde so you can see which event has been
print("Pad = " + string(async_load[? "pad_index"]));   // triggered and the pad associated with it.

if async_load[? "event_type"] == "gamepad discovered" {
    global.GP = async_load[? "pad_index"];
    print("Default gamepad set to " + string(global.GP), "connected:", gamepad_is_connected(global.GP));
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// When starting a level, none of the pickups have been used yet; however, they can be picked up, and shouldn't respawn when the room restarts
//This code makes sure all pickups spawn normally
var i, totalPickups;
totalPickups = instance_number(prtPickup);

for(i = 0; i &lt;= totalPickups; i++) {
    global.pickupCollected[i] = false;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="77">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if global.screen_shader != noone {
    shader_set(global.screen_shader);
    draw_surface(application_surface, 0, 0);
    shader_reset();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
